<!DOCTYPE html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Serialsüè≠factory</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css">
  <style>
    body {
      background-color: #002434;
    }
    .card {
      background-color: #012a3c;
      border: none;
      margin: 15px 0;
      border-radius: 8px;
    }
    .card-title, .card-text, .btn {
      color: rgb(211, 211, 211);
    }
    .wishlist-btn.active {
      color: #fff;
      background-color: #28a745;
    }
    .card img {
      border-top-left-radius: 8px;
      border-top-right-radius: 8px;
    }
    .wishlist-btn {
      transition: all 0.3s;
    }
    h1 {
      color: rgb(211, 211, 211);
    }
    header .btn-light {
      border-radius: 0.375rem;
    }
  </style>
</head>
<body>
  <header class="container-fluid py-3">
    <div class="d-flex justify-content-between align-items-center">
      <h1 class="text-center mt-5 flex-grow-1">Serialsüè≠factory - –º–∏ –ø–æ–≤–µ—Ä–Ω—É–ª–∏—Å—å. –¢–µ–ø–µ—Ä –∑ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—î—é, –±–∞–Ω–∫—ñ–≤—Å—å–∫–∏–º–∏ –∫–∞—Ä—Ç–∫–∞–º–∏ —ñ –ø–∞—Å–ø–æ—Ä—Ç–∞–º–∏ü¶æ</h1>
      <div class="d-flex gap-3">
        {% if username %}
          <div class="d-flex align-items-center gap-3">
            <img src="{{ avatar_url }}" alt="Avatar" class="rounded-circle" style="width: 50px; height: 50px;">
            <span class="text-light">{{ username }}</span>
            <a href="/wishlist" class="btn btn-outline-success">üìã –û–±—Ä–∞–Ω—ñ —Å–µ—Ä—ñ–∞–ª–∏</a>
            <a href="/logout" class="btn btn-outline-light">–í–∏–π—Ç–∏</a>
          </div>
        {% else %}
          <a href="/templates/register.html" class="btn btn-outline-light">–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è</a>
          <a href="/templates/auth.html" class="btn btn-light">–£–≤—ñ–π—Ç–∏</a>
        {% endif %}
      </div>
    </div>
    <div class="d-flex justify-content-center mt-3">
      <a href="/random-movie" class="btn btn-light ms-2">–†–∞–Ω–¥–æ–º–Ω–∏–π —Ñ—ñ–ª—å–º</a>
    </div>
    <div class="d-flex justify-content-center mt-3">
      <form action="/search" method="get" class="d-flex" style="max-width: 500px; width: 100%;">
        <input type="text" name="query" class="form-control" placeholder="–ü–æ—à—É–∫ —Å–µ—Ä—ñ–∞–ª—É..." aria-label="–ü–æ—à—É–∫ —Ñ—ñ–ª—å–º—ñ–≤">
        <button type="submit" class="btn btn-light ms-2">–ü–æ—à—É–∫</button>
      </form>
    </div>
  </header>
  <main class="container py-5">
    <div class="row">
        {% for series in all_series %}
        <div class="col-md-3">
            <a href="/templates/{{ series.series_name }}.html" class="card-link">
                <div class="card text-center">
                    <img src="/images/{{ series.image }}" class="card-img-top" alt="{{ series.series_name }}">
                    <div class="card-body">
                        <h5 class="card-title">{{ series.series_name }}</h5>
                        <p class="card-text">
                            <strong>–°–µ–∑–æ–Ω—ñ–≤:</strong> {{ series.seasons }}<br>
                            <strong>–í—Å—å–æ–≥–æ —Å–µ—Ä—ñ–π:</strong> {{ series.episodes }}<br>
                            <strong>–†–æ–∫–∏:</strong> {{ series.years }}
                        </p>
                        <button 
                            class="btn btn-outline-danger wishlist-btn {% if series.series_name in user_wishlist %}active{% endif %}" 
                            data-series="{{ series.series_name }}">
                            {% if series.series_name in user_wishlist %}‚úÖ{% else %}‚ù§Ô∏è{% endif %}
                        </button>
                    </div>
                </div>
            </a>
        </div>
        {% endfor %}
    </div>
  </main>

  <footer class="container-fluid bg-dark text-light py-4 mt-5">
    <div class="container">
      <div class="row">
        <div class="col-md-6">
          <h5>–ö–æ–Ω—Ç–∞–∫—Ç–∏</h5>
          <ul class="list-unstyled">
            <li>Email: support@serialsfactory.com</li>
            <li>–¢–µ–ª–µ—Ñ–æ–Ω: +38 (098) 123-45-67</li>
            <li>Telegram: @serialsfactory</li>
          </ul>
        </div>
        <div class="col-md-6 text-md-end">
          <h5>–ü—ñ–¥—Ç—Ä–∏–º–∞–π—Ç–µ –Ω–∞—à –ø—Ä–æ—î–∫—Ç</h5>
          <p>–î–æ–Ω–∞—Ç—å—Ç–µ –∞–≤—Ç–æ—Ä–∞–º)</p>
          <a href="https://www.donationalerts.com/r/serialsfactory" class="btn btn-outline-light">–ó–∞–¥–æ–Ω–∞—Ç–∏—Ç–∏</a>
        </div>
      </div>
    </div>
  </footer>
  <script>
    document.querySelectorAll('.wishlist-btn').forEach(button => {
      button.addEventListener('click', async function() {
          console.log("–ö–Ω–æ–ø–∫–∞ –Ω–∞—Ç–∏—Å–Ω—É—Ç–∞");
          const response = await fetch('/auth/check', { method: 'GET' });
          const authStatus = await response.json();

          if (!authStatus.authenticated) {
              console.log("–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏–π");
              window.location.href = '/auth';
              return;
          }

          console.log("–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏–π");
          const seriesId = this.getAttribute('data-series');
          const isAdding = !this.classList.contains('active');
          const endpoint = isAdding ? '/wishlist/add' : '/wishlist/remove';

          fetch(endpoint, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ series_name: seriesId })
          })
          .then(response => response.json())
          .then(data => {
              console.log(data); 
              if (data.status === "added" && isAdding) {
                  this.classList.add('active');
                  this.textContent = "‚úÖ";
              } else if (data.status === "removed" && !isAdding) {
                  this.classList.remove('active');
                  this.textContent = "‚ù§Ô∏è";
              }
          })
          .catch(error => {
              console.error('–ü–æ–º–∏–ª–∫–∞:', error);
              alert('–ù–µ –≤–¥–∞–ª–æ—Å—è –æ–Ω–æ–≤–∏—Ç–∏ —Å—Ç–∞–Ω –∫–Ω–æ–ø–∫–∏.');
          });
      });
  });
  </script>
</body>
</html>